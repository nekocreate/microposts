

        <li id="micropost-<%= micropost.id %>">
            ###micropostid###<%= micropost.id %><br />
            <%= link_to gravatar_for(micropost.user, size: 50), micropost.user %>
            <span class="user"><%= link_to micropost.user.name, micropost.user %></span>
            <span class="content"><%= micropost.content %></span>
            
            <%# if Micropost.find_by_id(micropost.retweetid).image.present? %>
            <%#= image_tag Micropost.find_by_id(micropost.retweetid).image %>

            <%= link_to image_tag(Micropost.find_by_id(micropost.retweetid).image.url,
            :size => "76x76"), Micropost.find_by_id(micropost.retweetid).image.url, :rel => "lightbox"%>


        </li>

        <li id="micropost-<%= micropost.id %>">
            ###micropostid###<%= micropost.id %><br />
            <%= link_to gravatar_for(micropost.user, size: 50), micropost.user %>
            <span class="user"><%= link_to micropost.user.name, micropost.user %></span>
            <span class="content"><%= micropost.content %></span>
        
            <% if micropost.image? %>
                <%#= image_tag micropost.image.thumb.url %><%# carrierwaveのサムネイルを表示させることもできる %>
                <%= link_to image_tag(micropost.image.url, :width => "200"), micropost.image.url, :rel => "lightbox" %><%# lightbox2によるモーダル表示 %>
            <% end %>


      
            <% if micropost.retweetid.present? %><%# reteetしたものはimageカラムが空っぽなので無理やり呼び出す %>
                <%#= Micropost.find_by_id(micropost.retweetid).image %><%# これで元つぶやきの画像のURLは取得できるが %>
                <!--<img src="<%#= Micropost.find_by_id(micropost.retweetid).image %>">--><%# carrierwaveのメソッドは使えないので直接呼び出す %>
                <% if Micropost.find_by_id(micropost.retweetid).image.present? %>
                    <%= image_tag Micropost.find_by_id(micropost.retweetid).image.url %>  
                    <%= link_to image_tag(Micropost.find_by_id(micropost.retweetid).image.url,
                    :size => "76x76"), Micropost.find_by_id(micropost.retweetid).image.url, :rel => "lightbox"%>
                <% end %>
            <% end %>
        
        








            <span class="timestamp">
                Posted <%= time_ago_in_words(micropost.created_at) %> ago.
                <% if current_user == micropost.user %>
                <i class="fa fa-trash"></i>
                    <%= link_to "delete", micropost, method: :delete,
                                                     data: { confirm: "You sure?" } %>
                    <%# 上記は、以下と同じ意味。
                    link_to "delete", micropost_path(micropost), method: :delete, data: { confirm: "You sure?" } 
                    routesの設定は、DELETE /microposts/:id(.:format)      microposts#destroy だから。
                    実際のHTMLソースは以下のようになる。
                    <a data-confirm="You sure?" rel="nofollow" data-method="delete" href="/microposts/1">delete</a>
                    よって、コントローラにはdestroyメソッド(アクション)を追加する。
                    %>
                <% end %>
            </span>
            
            <% if micropost.retweetid.present? %><%# retweetidカラムに値があったら %>
                <span class="content" style="background-color:#ffcaca;">
                <%= link_to micropost.user.name,user_path(micropost.user) %><%# retweetした人 %>
                さんが
                <% @moto_tweet_id = Micropost.find_by_id(micropost.retweetid).user_id %><%# retweetされた人のuser_id %>
                <% @moto_user_name = User.find_by_id(@moto_tweet_id).name %><%# retweetされた人のname %>
                <%= link_to @moto_user_name, user_path(@moto_tweet_id) %>
                さんのつぶやきをRetweetしました
                </span>
            <% end %>
        </li>





















<%# if micropost.retweetid.present? %>
    <%# unless Micropost.exists?(id: micropost.retweetid) %><%# 親のmicropostテーブルのidがない場合 %>
        <%# Micropost.destroy_all(id: micropost.id) %><%# このmicropostのレコードをテーブルから削除する %>
    <%# else %><%# 親のレコード番号がある場合は何もしない %>
        <!--親のレコード番号があるよ-->
    <%# end %>
<%# end %>

<%#= Micropost.where(retweetid: nil ).count %><%# retweetidがnilのレコード数 %>


